# Production overrides
# Usage: docker compose -f docker-compose.base.yml -f docker-compose.prod.yml up -d

services:
  traefik:
    # In production, you'd add TLS configuration here
    # volumes:
    #   - ./letsencrypt:/letsencrypt
    restart: always

  db:
    restart: always
    # No exposed ports in production
    # Use backups and replication in real prod

  redis:
    restart: always
    command: redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru

  api:
    restart: always
    environment:
      GIN_MODE: release
      LOG_LEVEL: info
      LOG_PRETTY: "false"
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

  app:
    restart: always
    environment:
      NODE_ENV: production
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
